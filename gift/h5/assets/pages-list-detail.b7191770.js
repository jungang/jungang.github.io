var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import{S as r,T as n,a as d,a9 as c,P as u,g as f,a7 as m,o as p,c as _,w as h,b as g,j as b,t as w,e as y,F as j,q as v,i as D,f as L,k as O,l as x,aa as $}from"./index.18541c3e.js";import{_ as P}from"./uni-dateformat.a1c3a06c.js";import{r as k}from"./uni-app.es.aff9600a.js";import{_ as N}from"./uni-list-item.7e7ca9e7.js";import{_ as S}from"./uni-list.c0a0c801.js";import{_ as C}from"./unicloud-db.c9c7daa2.js";import{_ as E}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.1f9744ac.js";const F=r.database().collection("read-news-log"),I={data:()=>({id:"",title:"title",field:"user_id.username,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'}}),computed:(R=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(i)for(var a of i(t))s.call(t,a)&&l(e,a,t[a]);return e})({},n({userInfo:"user/info",hasLogin:"user/hasLogin"})),B={uniStarterConfig:()=>d().globalData.config,where(){return`_id =="${this.id}"`}},t(R,a(B))),onLoad(e){console.log(e),e.id&&(this.id=e.id),e.title&&(this.title=e.title,c({title:e.title}))},onReady(){this.id?this.$refs.detail.loadData():u({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap(e){"share"==e.type&&this.shareClick()},methods:{$log(...e){console.log("args",...e,this.id)},setReadNewsLog(){let e={article_id:this.id,last_time:Date.now()},t=f("readNewsLog")||[],a=-1;t.forEach((({article_id:t},i)=>{t==e.article_id&&(a=i)})),-1===a?t.push(e):t.splice(a,1,e),m("readNewsLog",t),console.log(t)},setFavorite(){if(!this.hasLogin)return console.log("未登录用户");let e=this.id,t=Date.now();console.log({article_id:e,last_time:t}),F.where(`"article_id" == "${e}" && "user_id"==$env.uid`).update({last_time:t}).then((({result:{updated:t}})=>{console.log("updated",t),t||F.add({article_id:e}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},loadData(e){""==this.title&&e[0].title&&(this.title=e[0].title,c({title:e[0].title})),this.setReadNewsLog()},followClick(){u({title:this.$t("listDetail.follow"),icon:"none"})}}};var R,B;var M=E(I,[["render",function(e,t,a,i,o,s){const l=D,r=k(L("uni-dateformat"),P),n=k(L("uni-list-item"),N),d=k(L("uni-list"),S),c=O,u=x,f=$,m=k(L("unicloud-db"),C);return p(),_(l,{class:"article"},{default:h((()=>[g(l,{class:"article-title"},{default:h((()=>[b(w(o.title),1)])),_:1}),g(m,{options:o.formData,collection:"opendb-news-articles,uni-id-users",field:o.field,getone:!0,where:s.where,manual:!0,ref:"detail",foreignKey:"opendb-news-articles.user_id",onLoad:s.loadData},{default:h((({data:e,loading:t,error:a,options:i})=>[!t&&e?(p(),y(j,{key:0},[g(d,{border:!1},{default:h((()=>[g(n,{thumbSize:"lg",thumb:e.image},{body:h((()=>[g(l,{class:"header-content"},{default:h((()=>[g(l,{class:"uni-title"},{default:h((()=>[b(w(e.user_id&&e.user_id[0].username),1)])),_:2},1024)])),_:2},1024)])),footer:h((()=>[g(l,{class:"footer"},{default:h((()=>[g(l,{class:"uni-note"},{default:h((()=>[b("更新于 "),g(r,{date:e.last_modify_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["thumb"])])),_:2},1024),g(l,{class:"banner"},{default:h((()=>[g(c,{class:"banner-img",src:e.avatar,mode:"widthFix"},null,8,["src"]),g(l,{class:"banner-title"},{default:h((()=>[g(u,{class:"uni-ellipsis"},{default:h((()=>[b(w(e.excerpt),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(l,{class:"article-content"},{default:h((()=>[g(f,{nodes:e.content},null,8,["nodes"])])),_:2},1024)],64)):v("",!0)])),_:1},8,["options","field","where","onLoad"])])),_:1})}],["__scopeId","data-v-4e047e50"]]);export{M as default};
