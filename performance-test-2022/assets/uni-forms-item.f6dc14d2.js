import{W as e,s as t,l as s,o as r,c as i,w as l,b as a,n as o,a as h,r as n,d,e as m,t as u,f,i as g}from"./index.45e10b73.js";import{_ as b}from"./uni-icons.4aeae8d3.js";import{r as p}from"./uni-app.es.af6e5358.js";import{_ as c}from"./plugin-vue_export-helper.21dcd24c.js";var y=c({name:"uniFormsItem",props:{custom:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!0},name:String,required:Boolean,validateTrigger:{type:String,default:""},leftIcon:String,iconColor:{type:String,default:"#606266"},label:String,labelWidth:{type:[Number,String],default:""},labelAlign:{type:String,default:""},labelPosition:{type:String,default:""},errorMessage:{type:[String,Boolean],default:""},rules:{type:Array,default:()=>[]}},data:()=>({errorTop:!1,errorBottom:!1,labelMarginBottom:"",errorWidth:"",errMsg:"",val:"",labelPos:"",labelWid:"",labelAli:"",showMsg:"undertext",border:!1,isFirstBorder:!1,isArray:!1,arrayField:""}),computed:{msg(){return this.errorMessage||this.errMsg},fieldStyle(){let e={};return"top"==this.labelPos&&(e.padding="0 0",this.labelMarginBottom="6px"),"left"==this.labelPos&&!1!==this.msg&&""!=this.msg?(e.paddingBottom="0px",this.errorBottom=!0,this.errorTop=!1):"top"==this.labelPos&&!1!==this.msg&&""!=this.msg?(this.errorBottom=!1,this.errorTop=!0):(this.errorTop=!1,this.errorBottom=!1),e},justifyContent(){return"left"===this.labelAli?"flex-start":"center"===this.labelAli?"center":"right"===this.labelAli?"flex-end":void 0},labelLeft(){return("left"===this.labelPos?parseInt(this.labelWid):0)+"px"}},watch:{validateTrigger(e){this.formTrigger=e}},created(){this.form=this.getForm(),this.group=this.getForm("uniGroup"),this.formRules=[],this.formTrigger=this.validateTrigger,this.name&&-1!==this.name.indexOf("[")&&-1!==this.name.indexOf("]")&&(this.isArray=!0,this.arrayField=this.name,this.form.formData[this.name]=this.form._getValue(this.name,""))},mounted(){this.form&&this.form.childrens.push(this),this.init()},unmounted(){this.__isUnmounted=!0,this.unInit()},methods:{init(){if(this.form){let{formRules:e,validator:t,formData:s,value:r,labelPosition:i,labelWidth:l,labelAlign:a,errShowType:o}=this.form;this.labelPos=this.labelPosition?this.labelPosition:i,this.label?this.labelWid=this.labelWidth?this.labelWidth:l||70:this.labelWid=this.labelWidth?this.labelWidth:l||"auto",this.labelWid&&"auto"!==this.labelWid&&(this.labelWid+="px"),this.labelAli=this.labelAlign?this.labelAlign:a,this.form.isFirstBorder||(this.form.isFirstBorder=!0,this.isFirstBorder=!0),this.group&&(this.group.isFirstBorder||(this.group.isFirstBorder=!0,this.isFirstBorder=!0)),this.border=this.form.border,this.showMsg=o;let h=this.isArray?this.arrayField:this.name;if(!h)return;e&&this.rules.length>0&&(e[h]||(e[h]={rules:this.rules}),t.updateSchema(e)),this.formRules=e[h]||{},this.validator=t}else this.labelPos=this.labelPosition||"left",this.labelWid=this.labelWidth||65,this.labelAli=this.labelAlign||"left"},unInit(){this.form&&this.form.childrens.forEach(((e,t)=>{e===this&&(this.form.childrens.splice(t,1),delete this.form.formData[e.name])}))},getForm(e="uniForms"){let t=this.$parent,s=t.$options.name;for(;s!==e;){if(t=t.$parent,!t)return!1;s=t.$options.name}return t},clearValidate(){this.errMsg=""},setValue(e){let t=this.isArray?this.arrayField:this.name;if(t){if(this.errMsg&&(this.errMsg=""),this.form.formData[t]=this.form._getValue(t,e),!this.formRules||(this.formRules,"{}"===JSON.stringify(this.formRules)))return;this.triggerCheck(this.form._getValue(this.name,e))}},async triggerCheck(s,r){if(this.errMsg="",!this.validator||0===Object.keys(this.formRules).length)return;const i=this.isRequired(this.formRules.rules||[]);let l=this.isTrigger(this.formRules.validateTrigger,this.validateTrigger,this.form.validateTrigger),a=null;if(l||r){let e=this.isArray?this.arrayField:this.name;a=await this.validator.validateUpdate({[e]:s},this.form.formData)}i||void 0!==s&&""!==s||(a=null);const o=this.form.inputChildrens.find((e=>e.rename===this.name));return(l||r)&&a&&a.errorMessage?(o&&(o.errMsg=a.errorMessage),"toast"===this.form.errShowType&&e({title:a.errorMessage||"校验错误",icon:"none"}),"modal"===this.form.errShowType&&t({title:"提示",content:a.errorMessage||"校验错误"})):o&&(o.errMsg=""),this.errMsg=a?a.errorMessage:"",this.form.validateCheck(a||null),a||null},isTrigger:(e,t,s)=>!("submit"===e||!e)||void 0===e&&("bind"===t||!t&&"bind"===s),isRequired(e){let t=!1;for(let s=0;s<e.length;s++){if(e[s].required){t=!0;break}}return t}}},[["render",function(e,t,c,y,_,M){const v=f,B=p(s("uni-icons"),b),F=g;return r(),i(F,{class:o(["uni-forms-item",{"uni-forms-item--border":_.border,"is-first-border":_.border&&_.isFirstBorder,"uni-forms-item-error":M.msg}])},{default:l((()=>[a(F,{class:"uni-forms-item__box"},{default:l((()=>[a(F,{class:o(["uni-forms-item__inner",["is-direction-"+_.labelPos]])},{default:l((()=>[a(F,{class:"uni-forms-item__label",style:h({width:_.labelWid,justifyContent:M.justifyContent})},{default:l((()=>[n(e.$slots,"label",{},(()=>[c.required?(r(),i(v,{key:0,class:"is-required"},{default:l((()=>[d("*")])),_:1})):m("",!0),c.leftIcon?(r(),i(B,{key:1,class:"label-icon",size:"16",type:c.leftIcon,color:c.iconColor},null,8,["type","color"])):m("",!0),a(v,{class:"label-text"},{default:l((()=>[d(u(c.label),1)])),_:1}),c.label?(r(),i(F,{key:2,class:"label-seat"})):m("",!0)]),!0)])),_:3},8,["style"]),a(F,{class:o(["uni-forms-item__content",{"is-input-error-border":M.msg}])},{default:l((()=>[n(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])])),_:3},8,["class"]),M.msg?(r(),i(F,{key:0,class:o(["uni-error-message",{"uni-error-msg--boeder":_.border}]),style:h({paddingLeft:M.labelLeft})},{default:l((()=>[a(v,{class:"uni-error-message-text"},{default:l((()=>[d(u("undertext"===_.showMsg?M.msg:""),1)])),_:1})])),_:1},8,["class","style"])):m("",!0)])),_:3})])),_:3},8,["class"])}],["__scopeId","data-v-30762ac2"]]);export{y as _};
