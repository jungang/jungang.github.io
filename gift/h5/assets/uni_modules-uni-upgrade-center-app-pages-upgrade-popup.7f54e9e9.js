import{a5 as e,g as t,P as a,Q as s,aj as o,ak as l,a7 as n,a8 as i,o as d,c,w as r,b as u,j as h,t as f,e as p,F as g,q as _,ae as k,l as w,k as m,i as y,al as b,_ as F,am as P}from"./index.18541c3e.js";import{_ as S}from"./plugin-vue_export-helper.21dcd24c.js";let v=null;var x=S({data:()=>({installForBeforeFilePath:"",installed:!1,installing:!1,downloadSuccess:!1,downloading:!1,downLoadPercent:0,downloadedSize:0,packageFileSize:0,tempFilePath:"",title:"更新日志",contents:"",is_mandatory:!1,subTitle:"发现新版本",downLoadBtnTextiOS:"立即跳转更新",downLoadBtnText:"立即下载更新",downLoadingText:"安装包下载中，请稍后"}),onLoad({local_storage_key:a}){if(!a)return console.error("local_storage_key为空，请检查后重试"),void e();const s=t(a);if(!s)return console.error("安装包信息为空，请检查后重试"),void e();const o=["version","url","type"];for(let t in s)if(-1!==o.indexOf(t)&&!s[t])return console.error(`参数 ${t} 必填，请检查后重试`),void e();Object.assign(this,s),this.checkLocalStoragePackage()},onBackPress(){if(this.is_mandatory)return!0;v&&v.abort()},computed:{isWGT(){return"wgt"===this.type},isiOS(){return!this.isWGT&&this.platform.includes("iOS")}},methods:{checkLocalStoragePackage(){const e=t("__localFilePath__");if(e){const{version:t,savedFilePath:a,installed:s}=e;s||0!==function(e="0",t="0"){e=String(e).split("."),t=String(t).split(".");const a=Math.min(e.length,t.length);let s=0;for(let o=0;o<a;o++){const a=Number(e[o]),l=Number(t[o]);if(a>l){s=1;break}if(a<l){s=-1;break}}if(0===s&&e.length!==t.length){const o=e.length>t.length,l=o?e:t;for(let e=a;e<l.length;e++)if(Number(l[e])>0){s=o?1:-1;break}}return s}(t,this.version)?this.deleteSavedFile(a):(this.downloadSuccess=!0,this.installForBeforeFilePath=a,this.tempFilePath=a)}},async closeUpdate(){return this.downloading?this.is_mandatory?a({title:"下载中，请稍后……",icon:"none",duration:500}):void s({title:"是否取消下载？",cancelText:"否",confirmText:"是",success:t=>{t.confirm&&(v&&v.abort(),e())}}):this.downloadSuccess&&this.tempFilePath?(await this.saveFile(this.tempFilePath,this.version),void e()):void e()},downloadPackage(){this.downloading=!0,v=o({url:this.url,success:e=>{200==e.statusCode&&(this.downloadSuccess=!0,this.tempFilePath=e.tempFilePath,this.is_mandatory&&this.installPackage())},complete:()=>{this.downloading=!1,this.downLoadPercent=0,this.downloadedSize=0,this.packageFileSize=0,v=null}}),v.onProgressUpdate((e=>{this.downLoadPercent=e.progress,this.downloadedSize=(e.totalBytesWritten/Math.pow(1024,2)).toFixed(2),this.packageFileSize=(e.totalBytesExpectedToWrite/Math.pow(1024,2)).toFixed(2)}))},installPackage(){},restart(){this.installed=!1},async saveFile(e,t){const[a,s]=await l({tempFilePath:e});a||n("__localFilePath__",{version:t,savedFilePath:s.savedFilePath})},deleteSavedFile:e=>(i("__localFilePath__"),uni.removeSavedFile({filePath:e})),jumpToAppStore(){plus.runtime.openURL(this.url)}}},[["render",function(e,t,a,s,o,l){const n=w,i=m,S=y,v=b,x=F,T=P;return d(),c(S,{class:"mask flex-center"},{default:r((()=>[u(S,{class:"content botton-radius"},{default:r((()=>[u(S,{class:"content-top"},{default:r((()=>[u(n,{class:"content-top-text"},{default:r((()=>[h(f(o.title),1)])),_:1}),u(i,{class:"content-top",style:{top:"0"},width:"100%",height:"100%",src:"/gift/h5/assets/bg_top.84172c45.png"})])),_:1}),u(S,{class:"content-header"}),u(S,{class:"content-body"},{default:r((()=>[u(S,{class:"title"},{default:r((()=>[u(n,null,{default:r((()=>[h(f(o.subTitle),1)])),_:1})])),_:1}),u(S,{class:"body"},{default:r((()=>[u(v,{class:"box-des-scroll","scroll-y":"true"},{default:r((()=>[u(n,{class:"box-des"},{default:r((()=>[h(f(o.contents),1)])),_:1})])),_:1})])),_:1}),u(S,{class:"footer flex-center"},{default:r((()=>[l.isiOS?(d(),c(x,{key:0,class:"content-button",style:{border:"none",color:"#fff"},plain:"",onClick:l.jumpToAppStore},{default:r((()=>[h(f(o.downLoadBtnTextiOS),1)])),_:1},8,["onClick"])):(d(),p(g,{key:1},[o.downloadSuccess?o.downloadSuccess&&!o.installed?(d(),c(x,{key:1,class:"content-button",style:{border:"none",color:"#fff"},plain:"",loading:o.installing,disabled:o.installing,onClick:l.installPackage},{default:r((()=>[h(f(o.installing?"正在安装……":"下载完成，立即安装"),1)])),_:1},8,["loading","disabled","onClick"])):_("",!0):(d(),p(g,{key:0},[o.downloading?(d(),c(S,{key:0,class:"progress-box flex-column"},{default:r((()=>[u(T,{class:"progress","border-radius":"35",percent:o.downLoadPercent,activeColor:"#3DA7FF","show-info":"","stroke-width":"10"},null,8,["percent"]),u(S,{style:{width:"100%","font-size":"28rpx",display:"flex","justify-content":"space-around"}},{default:r((()=>[u(n,null,{default:r((()=>[h(f(o.downLoadingText),1)])),_:1}),u(n,null,{default:r((()=>[h("("+f(o.downloadedSize)+"/"+f(o.packageFileSize)+"M)",1)])),_:1})])),_:1})])),_:1})):(d(),c(x,{key:1,class:"content-button",style:{border:"none",color:"#fff"},plain:"",onClick:l.downloadPackage},{default:r((()=>[h(f(o.downLoadBtnText),1)])),_:1},8,["onClick"]))],64)),o.installed&&l.isWGT?(d(),c(x,{key:2,class:"content-button",style:{border:"none",color:"#fff"},plain:"",onClick:l.restart},{default:r((()=>[h(" 安装完毕，点击重启 ")])),_:1},8,["onClick"])):_("",!0)],64))])),_:1})])),_:1}),o.is_mandatory?_("",!0):(d(),c(i,{key:0,class:"close-img",src:"/gift/h5/assets/app_update_close.91137466.png",onClick:k(l.closeUpdate,["stop"])},null,8,["onClick"]))])),_:1})])),_:1})}],["__scopeId","data-v-376cb542"]]);export{x as default};
