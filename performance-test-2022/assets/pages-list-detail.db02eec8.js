var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import{R as r,Z as n,D as d,ac as c,W as u,C as f,aa as p,o as h,c as _,w as m,b as g,d as b,t as w,B as y,F as j,e as v,i as D,l as L,g as O,f as x,ad as $}from"./index.45e10b73.js";import{_ as N}from"./uni-dateformat.cfb1a0da.js";import{r as P}from"./uni-app.es.af6e5358.js";import{_ as k,a as C}from"./uni-list.6ff94966.js";import{_ as R}from"./unicloud-db.0375517d.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.4aeae8d3.js";const E=r.database().collection("read-news-log"),F={data:()=>({id:"",title:"title",field:"user_id.username,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'}}),computed:(I=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(i)for(var a of i(t))s.call(t,a)&&l(e,a,t[a]);return e})({},n({userInfo:"user/info",hasLogin:"user/hasLogin"})),S={uniStarterConfig:()=>d().globalData.config,where(){return`_id =="${this.id}"`}},t(I,a(S))),onLoad(e){console.log(e),e.id&&(this.id=e.id),e.title&&(this.title=e.title,c({title:e.title}))},onReady(){this.id?this.$refs.detail.loadData():u({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap(e){"share"==e.type&&this.shareClick()},methods:{$log(...e){console.log("args",...e,this.id)},setReadNewsLog(){let e={article_id:this.id,last_time:Date.now()},t=f("readNewsLog")||[],a=-1;t.forEach((({article_id:t},i)=>{t==e.article_id&&(a=i)})),-1===a?t.push(e):t.splice(a,1,e),p("readNewsLog",t),console.log(t)},setFavorite(){if(!this.hasLogin)return console.log("未登录用户");let e=this.id,t=Date.now();console.log({article_id:e,last_time:t}),E.where(`"article_id" == "${e}" && "user_id"==$env.uid`).update({last_time:t}).then((({result:{updated:t}})=>{console.log("updated",t),t||E.add({article_id:e}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},loadData(e){""==this.title&&e[0].title&&(this.title=e[0].title,c({title:e[0].title})),this.setReadNewsLog()},followClick(){u({title:this.$t("listDetail.follow"),icon:"none"})}}};var I,S;var M=B(F,[["render",function(e,t,a,i,o,s){const l=D,r=P(L("uni-dateformat"),N),n=P(L("uni-list-item"),k),d=P(L("uni-list"),C),c=O,u=x,f=$,p=P(L("unicloud-db"),R);return h(),_(l,{class:"article"},{default:m((()=>[g(l,{class:"article-title"},{default:m((()=>[b(w(o.title),1)])),_:1}),g(p,{options:o.formData,collection:"opendb-news-articles,uni-id-users",field:o.field,getone:!0,where:s.where,manual:!0,ref:"detail",foreignKey:"opendb-news-articles.user_id",onLoad:s.loadData},{default:m((({data:e,loading:t,error:a,options:i})=>[!t&&e?(h(),y(j,{key:0},[g(d,{border:!1},{default:m((()=>[g(n,{thumbSize:"lg",thumb:e.image},{body:m((()=>[g(l,{class:"header-content"},{default:m((()=>[g(l,{class:"uni-title"},{default:m((()=>[b(w(e.user_id&&e.user_id[0].username),1)])),_:2},1024)])),_:2},1024)])),footer:m((()=>[g(l,{class:"footer"},{default:m((()=>[g(l,{class:"uni-note"},{default:m((()=>[b("更新于 "),g(r,{date:e.last_modify_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["thumb"])])),_:2},1024),g(l,{class:"banner"},{default:m((()=>[g(c,{class:"banner-img",src:e.avatar,mode:"widthFix"},null,8,["src"]),g(l,{class:"banner-title"},{default:m((()=>[g(u,{class:"uni-ellipsis"},{default:m((()=>[b(w(e.excerpt),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(l,{class:"article-content"},{default:m((()=>[g(f,{nodes:e.content},null,8,["nodes"])])),_:2},1024)],64)):v("",!0)])),_:1},8,["options","field","where","onLoad"])])),_:1})}],["__scopeId","data-v-4e047e50"]]);export{M as default};
